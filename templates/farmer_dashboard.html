<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Farmer Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Google Fonts & Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f5f7fb;
      color: #333;
      display: flex;
    }

    /* Sidebar */
    .sidebar {
      width: 240px;
      background: #1e1e2f;
      color: white;
      padding: 40px 20px;
      height: 100vh;
      position: fixed;
    }

    .sidebar h2 {
      font-size: 22px;
      margin-bottom: 40px;
      color: #00d084;
    }

    .sidebar ul { list-style: none; padding: 0; }
    .sidebar ul li { margin: 20px 0; }
    .sidebar ul li a {
      color: white;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s ease;
    }
    .sidebar ul li a:hover { color: #00d084; }

    /* Main content */
    .main-content {
      margin-left: 260px;
      padding: 30px;
      width: 100%;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 30px;
    }

    .header h1 { font-size: 26px; color: #1e1e2f; }

    .profile-info {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      position: relative;
    }

    .profile-top {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 5px;
    }

    .profile-top p { font-size: 14px; color: #555; }
    .profile-info h2 { font-size: 18px; margin-bottom: 4px; color: #1e1e2f; }
    .profile-info p { font-size: 14px; color: #777; }

    /* Notification Dropdown */
    .notification-wrapper { position: relative; }
    #notif-bell { font-size: 20px; cursor: pointer; }

    .notification-dropdown {
      display: none;
      position: absolute;
      top: 30px;
      right: 0;
      background: #fff;
      color: #333;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      width: 260px;
      padding: 10px;
      z-index: 10;
    }

    .notification-dropdown h4 {
      margin-bottom: 10px;
      font-size: 14px;
      border-bottom: 1px solid #ddd;
      padding-bottom: 5px;
    }

    .notification-dropdown ul { list-style: none; padding: 0; margin: 0; }
    .notification-dropdown ul li {
      font-size: 13px;
      padding: 6px 0;
      border-bottom: 1px solid #f0f0f0;
    }
    .notification-dropdown ul li:last-child { border-bottom: none; }

    /* Cards */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      transition: all 0.3s ease;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    }

    .card h3 { font-size: 16px; margin-bottom: 12px; color: #333; }
    .card p { font-size: 14px; line-height: 1.6; }

    .status-good { color: green; font-weight: bold; }
    .status-alert { color: red; font-weight: bold; }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <h2>AGROSCAN</h2>
    <ul>
      <li><a href="#">Dashboard</a></li>
      <li><a href="{{ url_for('soil_prediction') }}">Soil Prediction</a></li>
      <li><a href="{{ url_for('predict_crop') }}">Crop Health</a></li>
      <li><a href="{{ url_for('query_form') }}">Ask Query</a></li>
      <li><a href="{{ url_for('weather_page') }}">Live Weather</a></li>
      <li><a href="{{ url_for('logout') }}">Logout</a></li>
    </ul>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="header">
      <h1>Welcome, {{ username }}</h1>

      <div class="profile-info">
        <div class="profile-top">
          <p id="datetime"></p>
          <div class="notification-wrapper">
            <i class="fa-solid fa-bell" id="notif-bell"></i>
            <div class="notification-dropdown" id="notif-box">
              <h4>ðŸ”” Notifications</h4>
              <ul>
                <li>{{ weather_alert }}</li>
                <li>Query Status: {{ query_status }}</li>
              </ul>
            </div>
          </div>
        </div>
        <h2>Location: {{ location }}</h2>
        <p>Role: Farmer</p>
      </div>
    </div>

   <!-- Data Cards -->
<div class="grid">
  <!-- Weather Update -->
  <div class="card">
    <h3>Weather Update</h3>
    <p class="status-{{ weather_status_class }}">{{ weather_status_label }}</p>
    <p>{{ weather_alert }}</p>
  </div>

  <!-- Soil Recommendation -->
  <div class="card">
    <h3>Soil Recommendation</h3>
    <p><strong>Crop:</strong> {{ soil_recommendation.crop }}</p>
    <p><strong>Soil:</strong> {{ soil_recommendation.soil }}</p>
    <p><strong>Fertilizer:</strong> {{ soil_recommendation.fertilizer }}</p>
  </div>

  <!-- Crop Health -->
  <div class="card">
    <h3>Crop Health</h3>
    <p class="{{ 'status-good' if crop_health == 'Healthy' else 'status-alert' }}">{{ crop_health }}</p>
  </div>

  <!-- Recent Queries -->
  <div class="card" style="grid-column: 1 / -1;">
    <h3><b>Recent Queries</b></h3>
    {% if query_list %}
      <ul style="list-style:none; padding:0; margin:0;">
        {% for q in query_list %}
          <li style="margin-bottom:10px;">
            <p style="font-size:13px; font-weight:600;">{{ q.question[:40] }}...</p>
            <p style="font-size:12px; color:#555;">{{ q.answer }}</p>
            <span style="font-size:12px; color: {{ 'green' if 'Answered' in q.status else 'orange' }};">
              {{ q.status }}
            </span>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No queries yet</p>
    {% endif %}

    <!-- Ask New Query button -->
    <div style="margin-top:15px; text-align:right;">
      <a href="{{ url_for('query_form') }}" 
         style="background:#00b894; color:white; padding:6px 12px; border-radius:6px; text-decoration:none; font-size:13px;">
        Ask New Query â†’
      </a>
    </div>
  </div>

  <!-- ðŸ“Š Recent Activity -->
  <div class="card" style="grid-column: 1 / -1;">
    <h3><b> Activity </b></h3>
    {% if analytics %}
      <ul style="list-style:none; padding:0; margin:0;">
        {% for a in analytics %}
          <li style="margin-bottom:8px; font-size:13px;">
            <strong>Query:</strong> {{ a.question[:40] }}... 
            <span style="color:#555;">({{ a.timestamp.strftime('%d %b %Y %I:%M %p') }})</span>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No activity yet</p>
    {% endif %}
  </div>

  <!-- Market Prices -->
  <div class="card">
    <h3><b>Market Prices</b></h3>
    <ul style="list-style:none; padding:0; margin:0;">
      {% for crop, price in crop_prices.items() %}
        <li style="margin-bottom:6px; font-size:13px;">
          <strong>{{ crop }}</strong>: {{ price }}
        </li>
      {% endfor %}
    </ul>
  </div>

  <!-- Farming Tip -->
  <div class="card">
    <h3><B>Tip of the Day</B>></h3>
    <p style="font-size:14px; color:#333;">{{ farming_tip }}</p>
  </div>
</div>


  <!-- Scripts -->
  <script>
    // Update Date & Time
    function updateDateTime() {
      const now = new Date();
      const options = { weekday: 'long', year: 'numeric', month: 'short', day: 'numeric' };
      document.getElementById('datetime').innerText = 
        now.toLocaleDateString('en-US', options) + " | " + now.toLocaleTimeString();
    }
    setInterval(updateDateTime, 1000);
    updateDateTime();

    // Toggle Notification Dropdown
    document.getElementById("notif-bell").addEventListener("click", function() {
      const box = document.getElementById("notif-box");
      box.style.display = (box.style.display === "block") ? "none" : "block";
    });

    // Close dropdown when clicking outside
    document.addEventListener("click", function(e) {
      const box = document.getElementById("notif-box");
      const bell = document.getElementById("notif-bell");
      if (!box.contains(e.target) && !bell.contains(e.target)) {
        box.style.display = "none";
      }
    });
  </script>

</body>
</html>
